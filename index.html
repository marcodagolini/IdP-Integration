<!--
Created By: Marco Dagolini
Version: 1.1
Date: 8/7/16
Email: mdagolini@liveperson.com
-->
<!DOCTYPE html>
<html lang="en">
  
  


  
    
    <head>
        <meta charset="utf-8">
        <title>LivePerson IdP Integration</title>
        <script src="https://lpcdn-a.lpsnmedia.net/webagent/client-SDK.min.js"></script>
        <script src="https://apis.google.com/js/api.js"></script>
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script src="https://lpcdn.lpsnmedia.net/webagent/client-SDK.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="https://cdn.auth0.com/js/lock/10.2.1/lock.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    
    </head>
    <body>
      
      
      
      
      
      
     <div id="contenitore" style="width:300px; height:200px; background-color:transparent">
         <div id="spessore" style="width:300px; height:10px; background-color:transparent"></div>
         <div id="titolo" style="width:300px; height:50px; background-color:transparent"> <p id="scrittatitolo" align="center" style="color:red">Nel primo paragrafo di questa trattazione, ci occuperemo 
dell'importanza del testo nel Web.</p> </div>
         <div id="dati" style="float:left; width:200px; height:150px; top:10px; right:10px">
 
                <p id="Auth_Name">Name:</p>
                <p id="Auth_Phone">Phone:</p>
                <p id="Auth_Email">Email:</p>
                <p id="Auth_Picture">Picture:</p>
                <p id="Auth_Balance">Balance:</p>
        
   
 
          </div>

      
          <div id="picture" style="background-size: 100%; background-image: url(https://i.imgur.com/AxboLNf.jpg);float:left; width:100px; height:100px; top:10px; left:10px">
          </div>
      </div>
      
      
     <script type="text/javascript">
              
     
              
            $(document).ready(function() {
              
              var SDK=lpTag.agentSDK;
              SDK.init();
              
      
                setTimeout(function(){ //gestione IdP
                       var options = {packages: ['corechart'], callback : myCallback};
                       google.load('visualization', '1', options);
                       function callback() {
                       }
                       function myCallback() {
                                setTimeout(function(){ 
                                                     
					
					
					             
                                                      var onSuccess = function(givemearesult) {
							     
							
							      var valore = givemearesult.newValue;
							      alert (valore);
								    alert("test ok");
							   
							      
							      };
					              var onError = function(err) {
  					                    alert("error");
					              };
					              var pathToData = "ctmrinfo.customerId";
					              lpTag.agentSDK.get(pathToData, onSuccess, onError);
					             
					            // var pathToData = "visitorInfo.visitorName";
                                                    // lpTag.agentSDK.get(pathToData, onSuccess, onError);
							      
							      
					               
					              
					
					
					var iftoken = 0;
					   
                                                      if (iftoken) {
							        
        
                          
                                                                   var data = JSON.parse(localStorage.getItem('profile'));
                                                                   var identificativo = data.user_id;
                                                                   var String = 'SELECT A, B, C, D, E, F WHERE A=' + "'"+ identificativo + "'";
                                                                   var queryString = encodeURIComponent(String);        
                                                                   var myURL = 'https://docs.google.com/spreadsheets/d/1-bGbupGHbTfYv0aNEchYzU2dvIPTWiYGNaF427AO9oI/gviz/tq?gid=342369015&tq=' + queryString;
                                                                   var query = new google.visualization.Query(myURL);
                                                                   query.send(handleQueryResponse);
                                                                   function handleQueryResponse(response) {
									      
                                                                                                           if (response.isError()) {
                                                                                                                                    alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                                                                                                                                    return;
                                                                                                                                    }
                                                                                                           var data = response.getDataTable();
                                                                                                           var auth_id = data.getValue(0, 0);
                                                                                                           var auth_name = data.getValue(0, 1);
                                                                                                           var auth_phone = data.getValue(0, 2);
                                                                                                           var auth_email = data.getValue(0, 3);
                                                                                                           var auth_picture = data.getValue(0, 4);
                                          alert(auth_picture);
                                                                                                           var auth_balance = data.getValue(0, 5);
                                                                                                           document.getElementById("picture").style.backgroundImage = 'url('+auth_picture+')';
                                                                                                           document.getElementById("Auth_Name").innerHTML = auth_name;
                                                                                                           document.getElementById("Auth_Phone").innerHTML = auth_phone;
                                                                                                           document.getElementById("Auth_Email").innerHTML = auth_email;
                                                                                                           document.getElementById("Auth_Balance").innerHTML = auth_balance;
                                                                                                           document.getElementById("scrittatitolo").style.color = "white";
                                                                                                           document.getElementById("scrittatitolo").innerHTML = "Visitatore Autenticato";
                                                                                                           document.getElementById("contenitore").style.backgroundColor = "green";
                                                                                                           }
                                                                    
                                                                    }
                                                                else{
                                                                         // document.getElementById("scrittatitolo").innerHTML = "Visitatore Autenticato";
								}
                                                                     
      
                                                	}, 3000);
                                         }
	               }, 3000);
              
              
           });
  
        
      </script>    
      
      
      
  </body>
</html>
